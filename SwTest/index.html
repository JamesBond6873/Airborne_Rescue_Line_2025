<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Airborne Rescue Line Robot Data</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 1.5rem;
      background-color: #f8f9fa;
    }

    h1 {
      text-align: center;
      margin-bottom: 1.0rem;
      font-size: 3rem;
    }

    .section {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
      padding: 1rem;
      border: 1px solid #ccc;
      border-radius: 0.5rem;
      background-color: #ffffff;
    }

    .section h2 {
      grid-column: span 5;
      margin-bottom: 1.0rem;
      font-size: 1.5rem;
    }

    .field {
      display: flex;
      flex-direction: row; /* OR just remove this line */
      justify-content: space-between; /* optional: spreads label & value */
      align-items: center;
      font-size: 0.9rem;
      background-color: #f0f0f0;
      padding: 0.5rem;
      border-radius: 0.5rem;
    }

    .label {
      font-weight: bold;
      margin-bottom: 0.2rem;
    }

    .value {
      color: #333;
    }
  </style>
</head>
<body>
  <h1>Live Robot Data</h1>
  <input type="text" id="ip-input" placeholder="Enter IP (e.g. 192.168.1.177:8000)" />
  <button onclick="connectWebSocket()">Connect</button>

  <div class="section">
    <h2>General Info </h2> 
    <div class="field"><span class="label">Timestamp:</span><span class="value" id="timestamp"></span></div>
    <div class="field"><span class="label">Terminate:</span><span class="value" id="terminate"></span></div>
    <div class="field"><span class="label">Run Time:</span><span class="value" id="runtime"></span></div>
    <div class="field"><span class="label">Objective:</span><span class="value" id="objective"></span></div>
    <div class="field"><span class="label">Avoiding Being Stuck:</span><span class="value" id="Data1G"></span></div>
    <div class="field"><span class="label">Data 1:</span><span class="value" id="Data 01G"></span></div>
    <div class="field"><span class="label">Data 2:</span><span class="value" id="Data 02G"></span></div>
    <div class="field"><span class="label">Data 3:</span><span class="value" id="Data 03G"></span></div>
    <div class="field"><span class="label">Data 4:</span><span class="value" id="Data 04G"></span></div>
    <div class="field"><span class="label">Data 5:</span><span class="value" id="Data 05G"></span></div>
    <div class="field"><span class="label">LOP State:</span><span class="value" id="lopState"></span></div>
    <div class="field"><span class="label">LOP Override:</span><span class="value" id="lopOverride"></span></div>
    <div class="field"><span class="label">LOP Counter:</span><span class="value" id="lopCounter"></span></div>
    <div class="field"><span class="label">Motor Override:</span><span class="value" id="motorOverride"></span></div>
    <div class="field"><span class="label">Image Similarity:</span><span class="value" id="Data2G"></span></div>
    <div class="field"><span class="label">Left Motors:</span><span class="value" id="leftMotors"></span></div>
    <div class="field"><span class="label">Right Motors:</span><span class="value" id="rightMotors"></span></div>
    <div class="field"><span class="label">Motor Difference:</span><span class="value" id="Data3G"></span></div>
    <div class="field"><span class="label">Pitch:</span><span class="value" id="Data4G"></span></div>
    <div class="field"><span class="label">Stuck Detected:</span><span class="value" id="Data5G"></span></div>
    <div class="field"><span class="label">Accel X:</span><span class="value" id="Data6G"></span></div>
    <div class="field"><span class="label">Accel Y:</span><span class="value" id="Data7G"></span></div>
    <div class="field"><span class="label">Accel Z:</span><span class="value" id="Data8G"></span></div>
    <div class="field"><span class="label">Ramp Detected:</span><span class="value" id="Data9G"></span></div>
    <div class="field"><span class="label">Was On Ramp:</span><span class="value" id="Data10G"></span></div>
    <div class="field"><span class="label">Gyro X:</span><span class="value" id="Data11G"></span></div>
    <div class="field"><span class="label">Gyro Y:</span><span class="value" id="Data12G"></span></div>
    <div class="field"><span class="label">Gyro Z:</span><span class="value" id="Data13G"></span></div>
    <div class="field"><span class="label">Ramp Up:</span><span class="value" id="Data14G"></span></div>
    <div class="field"><span class="label">Ramp Down:</span><span class="value" id="Data15G"></span></div>
    <div class="field"><span class="label">ToF 1:</span><span class="value" id="Data16G"></span></div>
    <div class="field"><span class="label">ToF 2:</span><span class="value" id="Data17G"></span></div>
    <div class="field"><span class="label">ToF 3:</span><span class="value" id="Data18G"></span></div>
    <div class="field"><span class="label">ToF 4:</span><span class="value" id="Data19G"></span></div>
    <div class="field"><span class="label">ToF 5:</span><span class="value" id="Data20G"></span></div>
    <div class="field"><span class="label">Data 21:</span><span class="value" id="Data21G"></span></div>
    <div class="field"><span class="label">Data 22:</span><span class="value" id="Data22G"></span></div>
    <div class="field"><span class="label">Data 23:</span><span class="value" id="Data23G"></span></div>
    <div class="field"><span class="label">Data 24:</span><span class="value" id="Data24G"></span></div>
    <div class="field"><span class="label">Data 25:</span><span class="value" id="Data25G"></span></div>
  </div> 

  <div class="section">
    <h2>üìè Line Following</h2>
    <div class="field"><span class="label">Line Center X:</span><span class="value" id="Data1L"></span></div>
    <div class="field"><span class="label">Line Angle:</span><span class="value" id="Data2L"></span></div>
    <div class="field"><span class="label">Line Angle Normalized:</span><span class="value" id="Data3L"></span></div>
    <div class="field"><span class="label">Data 4:</span><span class="value" id="Data4L"></span></div>
    <div class="field"><span class="label">POI Choice Reason:</span><span class="value" id="Data5L"></span></div>
    <div class="field"><span class="label">Line Bias:</span><span class="value" id="Data6L"></span></div>
    <div class="field"><span class="label">Angle Bias:</span><span class="value" id="Data7L"></span></div>
    <div class="field"><span class="label">Data 8:</span><span class="value" id="Data8L"></span></div>
    <div class="field"><span class="label">Data 9:</span><span class="value" id="Data9L"></span></div>
    <div class="field"><span class="label">Line Crop Percentage:</span><span class="value" id="Data10L"></span></div>
    <div class="field"><span class="label">Image Cropped:</span><span class="value" id="Data11L"></span></div>
    <div class="field"><span class="label">Line Detected:</span><span class="value" id="Data12L"></span></div>
    <div class="field"><span class="label">In Gap:</span><span class="value" id="Data13L"></span></div>
    <div class="field"><span class="label">Red Strip Detected:</span><span class="value" id="Data14L"></span></div>
    <div class="field"><span class="label">Intersection Direction:</span><span class="value" id="Data15L"></span></div>
    <div class="field"><span class="label">Gap Angle:</span><span class="value" id="Data16L"></span></div>
    <div class="field"><span class="label">Gap Center X</span><span class="value" id="Data17L"></span></div>
    <div class="field"><span class="label">Gap Center Y:</span><span class="value" id="Data18L"></span></div>
    <div class="field"><span class="label">Data 19:</span><span class="value" id="Data19L"></span></div>
    <div class="field"><span class="label">Data 20:</span><span class="value" id="Data20L"></span></div>
    <div class="field"><span class="label">Silver Strip Confidence:</span><span class="value" id="Data21L"></span></div>
    <div class="field"><span class="label">Silver Strip Average:</span><span class="value" id="Data22L"></span></div>
    <div class="field"><span class="label">Silver Line Detected:</span><span class="value" id="Data23L"></span></div>
    <div class="field"><span class="label">Gap State:</span><span class="value" id="Data24L"></span></div>
    <div class="field"><span class="label">Gap Direction:</span><span class="value" id="Data25L"></span></div>
    <div class="field"><span class="label">Silver Line Angle:</span><span class="value" id="Data26L"></span></div>
    <div class="field"><span class="label">Silver Line Center X:</span><span class="value" id="Data27L"></span></div>
    <div class="field"><span class="label">Silver Line Center Y:</span><span class="value" id="Data28L"></span></div>
    <div class="field"><span class="label">Data 29:</span><span class="value" id="Data29L"></span></div>
    <div class="field"><span class="label">Data 30:</span><span class="value" id="Data30L"></span></div>
  </div>

  <div class="section">
    <h2>üßØ Evacuation Zone</h2>
    <div class="field"><span class="label">Evacuation Zone Time:</span><span class="value" id="evacTime"></span></div>
    <div class="field"><span class="label">Rescued Alive:</span><span class="value" id="Data2E"></span></div>
    <div class="field"><span class="label">Rescued Dead:</span><span class="value" id="Data3E"></span></div>
    <div class="field"><span class="label">Picked Up Alive:</span><span class="value" id="Data4E"></span></div>
    <div class="field"><span class="label">Picked Up Dead:</span><span class="value" id="Data5E"></span></div>
    <div class="field"><span class="label">Zone Status:</span><span class="value" id="Data6E"></span></div>
    <div class="field"><span class="label">Data 7:</span><span class="value" id="Data7E"></span></div>
    <div class="field"><span class="label">Data 8:</span><span class="value" id="Data8E"></span></div>
    <div class="field"><span class="label">Data 9:</span><span class="value" id="Data9E"></span></div>
    <div class="field"><span class="label">Data 10:</span><span class="value" id="Data10E"></span></div>
  </div>

  <!-- Toggle Buttons -->
  <button class="toggle-btn" data-name="MotorOverride" data-output-on="MotorOverride 1" data-output-off="MotorOverride 0" data-watch="motorOverride">Motor Override</button>
  <button class="toggle-btn" data-name="LOPOverride" data-output-on="LOPOverride 1" data-output-off="LOPOverride 0" data-watch="lopOverride">LOP Override</button>
  <button class="toggle-btn" data-name="LOPState" data-output-on="LOPState 1" data-output-off="LOPState 0" data-watch="motorOverride">LOP State</button>

  <!-- Selector Group 1 -->
  <button class="selector-btn" data-name="ObjectiveFL" data-group="group1" data-output="Objective FL">Line Following</button>
  <button class="selector-btn" data-name="ObjectiveEZ" data-group="group1" data-output="Objective EZ">Evacuation Zone</button>

  <!-- Selector Group 2 -->
  <button class="selector-btn" data-name="ZoneStatusNotStarted" data-group="group2" data-output="ZoneStatus notStarted">Not Started</button>
  <button class="selector-btn" data-name="ZoneStatusBegin" data-group="group2" data-output="ZoneStatus begin">Begin</button>
  <button class="selector-btn" data-name="ZoneStatusEntry" data-group="group2" data-output="ZoneStatus entry">Entry</button>
  <button class="selector-btn" data-name="ZoneStatusFindVictims" data-group="group2" data-output="ZoneStatus findVictims">Find Victims</button>
  <button class="selector-btn" data-name="ZoneStatusGoToBall" data-group="group2" data-output="ZoneStatus goToBall">Go To Ball</button>
  <button class="selector-btn" data-name="ZoneStatusDepositGreen" data-group="group2" data-output="ZoneStatus depositGreen">Deposit Green</button>
  <button class="selector-btn" data-name="ZoneStatusDepositRed" data-group="group2" data-output="ZoneStatus depositRed">Deposit Red</button>
  <button class="selector-btn" data-name="ZoneStatusExit" data-group="group2" data-output="ZoneStatus exit">Exit</button>

  <button class="quick-btn" data-name="DoSomethingQuick" data-output="exit">Terminate</button>
  <div class="section">
    <h2>üñ•Ô∏è Console</h2>
    <div style="grid-column: span 5; display: flex; flex-direction: column;">
      <div id="console-output" style="height: 200px; overflow-y: auto; background: #000; color: #0f0; font-family: monospace; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;"></div>
      <div style="display: flex; gap: 0.5rem;">
        <input id="console-input" type="text" placeholder="Type a command..." style="flex: 1; padding: 0.5rem; border-radius: 0.5rem; border: 1px solid #ccc;" />
        <button onclick="sendCommand()" style="padding: 0.5rem 1rem; border: none; background-color: #007bff; color: white; border-radius: 0.5rem; cursor: pointer;">Send</button>
      </div>
    </div>
  </div>

  <script>
    let ws;

    const consoleOutput = document.getElementById("console-output");
    const consoleInput = document.getElementById("console-input");

    function connectWebSocket() {
      const ipInput = document.getElementById("ip-input").value.trim();
      const url = `ws://${ipInput}`;
      ws = new WebSocket(url);

      ws.onopen = () => {
        appendConsoleMessage(`Connected to ${url}`);

        // Move all listeners inside here so they're set up after connection
        document.querySelectorAll(".toggle-btn").forEach((btn) => {
          btn.toggleState = 0;
          btn.onclick = () => {
            btn.toggleState = btn.toggleState ? 0 : 1;
            const message = btn.toggleState
              ? btn.getAttribute("data-output-on")
              : btn.getAttribute("data-output-off");
            ws.send(message);
            btn.style.backgroundColor = btn.toggleState ? "lightgreen" : "";
          };
        });

        document.querySelectorAll(".selector-btn").forEach((btn) => {
          btn.onclick = () => {
            const group = btn.getAttribute("data-group");
            const output = btn.getAttribute("data-output") || btn.getAttribute("data-name");

            document.querySelectorAll(`.selector-btn[data-group='${group}']`).forEach((b) => {
              b.classList.remove("selected");
              b.style.backgroundColor = "";
            });

            btn.classList.add("selected");
            btn.style.backgroundColor = "lightgreen";

            ws.send(output);
          };
        });

        document.querySelectorAll(".quick-btn").forEach((btn) => {
          btn.onclick = () => {
            const output = btn.getAttribute("data-output") || "1";
            ws.send(output);
            btn.style.backgroundColor = "lightcoral";
            setTimeout(() => {
              btn.style.backgroundColor = "";
            }, 150);
          };
        });

        consoleInput.addEventListener("keydown", (e) => {
          if (e.key === "Enter") sendCommand();
        });
      };

      ws.onmessage = (event) => {
        try {
          const data = JSON.parse(event.data);

          if (data.type === "console") {
            appendConsoleMessage(data.content);
            return;
          }

          const ids = [
            "timestamp",      
            "terminate",      
            "runtime",      
            "objective",        
            "Data1G",         // --
            "Data01G",
            "Data02G",
            "Data03G",
            "Data04G",
            "Data05G",         // --
            "lopState",       
            "lopOverride",    
            "lopCounter",     
            "motorOverride",  
            "Data2G",         // --
            "leftMotors",     
            "rightMotors",    
            "Data3G",
            "Data4G",
            "Data5G",         // --
            "Data6G",
            "Data7G",
            "Data8G",
            "Data9G",
            "Data10G",        // --
            "Data11G",
            "Data12G",
            "Data13G",
            "Data14G",
            "Data15G",        // --
            "Data16G",
            "Data17G",
            "Data18G",
            "Data19G",
            "Data20G",        // --
            "Data21G",
            "Data22G",
            "Data23G",
            "Data24G",
            "Data25G",         // --
            "Data1L",
            "Data2L",
            "Data3L",
            "Data4L",
            "Data5L",         // --
            "Data6L",
            "Data7L",
            "Data8L",
            "Data9L",
            "Data10L",        // --
            "Data11L",
            "Data12L",
            "Data13L",
            "Data14L",
            "Data15L",        // --
            "Data16L",
            "Data17L",
            "Data18L",
            "Data19L",
            "Data20L",        // --
            "Data21L",
            "Data22L",
            "Data23L",
            "Data24L",
            "Data25L",         // --
            "Data26L",
            "Data27L",
            "Data28L",
            "Data29L",
            "Data30L",         // --
            "evacTime",       
            "Data2E",
            "Data3E",
            "Data4E",
            "Data5E",         // --
            "Data6E",
            "Data7E",
            "Data8E",
            "Data9E",
            "Data10E",        // --
        ];

          const set = (id, value) => {
            const el = document.getElementById(id);
            if (!el) return;
            el.textContent = value;

            if (value === "True") {
              el.classList.add("true");
              el.classList.remove("false");
            } else if (value === "False") {
              el.classList.add("false");
              el.classList.remove("true");
            } else {
              el.classList.remove("true", "false");
            }
          };

          ids.forEach((id, index) => set(id, data[index]));
        } catch (err) {
          appendConsoleMessage("Error parsing message: " + err);
        }
      };

      ws.onerror = (err) => {
        appendConsoleMessage("WebSocket error: " + (err.message || err));
      };

      ws.onclose = () => {
        appendConsoleMessage("WebSocket closed.");
      };
    }

    function sendCommand() {
      const command = consoleInput.value.trim();
      if (command !== "") {
        ws.send(command);
        appendConsoleMessage(">> " + command);
        consoleInput.value = "";
      }
    }

    function appendConsoleMessage(message) {
      const line = document.createElement("div");
      line.textContent = message;
      consoleOutput.appendChild(line);
      consoleOutput.scrollTop = consoleOutput.scrollHeight;
    }
  </script>
</body>
</html>

